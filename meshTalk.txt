meshTalk v0.4.0
Author: Anton Vologzhanin (R3VAF)
Updated: 2026-02-12

========================
EN
========================

Purpose
- Research prototype for P2P payload exchange over Meshtastic (ACK/retry + cryptographic primitives).
- Focused on best-effort delivery stats and experimental topology behavior study.

License
- Apache License 2.0 (`LICENSE`).
- Redistribution must preserve attribution notices from `NOTICE`.

Project vision
- Intended for civilian/hobby/research use.
- Built for delivery/latency experiments and mesh behavior study.
- Military use is explicitly prohibited.
- Any unlawful use (including terrorist, extremist, criminal activity) is explicitly prohibited.
- Disclaimer: software is provided "AS IS", without warranties of any kind.
- Disclaimer: the author is not liable for any direct or indirect damage caused by use or misuse.

Main UI
- Left: contacts/dialogs list.
- Right: chat area.
- Top: header status bar with `Client ID`, names, and masked `public key`.
  - Orange: initialization / transitional states (waiting for radio).
  - Dark green: connected, no unacknowledged errors.
  - Red: errors happened in log and require user attention (until Settings is opened).
- Bottom: input field and Send button.

Initialization
- GUI starts even if radio is not connected.
- Radio connection is serial-over-USB (COM on Windows, `/dev/ttyUSB*`/`/dev/ttyACM*` on Linux).
- Default port mode is `--port auto`: on startup the app scans serial ports and picks the best candidate automatically.
- App waits for device, then auto-connects and loads profile data.
- Settings/history are loaded only after node initialization.
- Multipart receive state is resumed after restart.

Top row behavior
- `Client ID: !xxxxxxxx <longname>[<shortname>] public key: 12345****67890`
- Left-click on top row copies Client ID.
- Triple-click on `public key:` asks confirmation, regenerates local keys, broadcasts new key.

Message status examples
- Outgoing in progress:
  `sent at 10:18 elapsed 00:05`
- Outgoing multipart in progress:
  `sent at 10:18 elapsed 00:12, parts 2/5`
- Outgoing delivered:
  `sent at 10:18 delivered at 10:19 in 01:18, on the 1 attempt, hops there 0 back 0`
- Outgoing delivered with compression:
  `sent at 10:18 delivered at 10:19 in 01:18, on the 1 attempt, hops there 0 back 0, compression DEFLATE 42%`
- Incoming multipart in progress:
  `at 10:18 started receiving, elapsed 00:15 parts 2/5 attempts 1, hops 1`
- Incoming completed:
  `sent at 10:18 received at 10:19 in 01:18, attempts 1, hops 1, parts 5/5`
- Meshtastic plain outgoing (direct/Primary):
  `sent at 10:19`
- Meshtastic plain incoming (direct/Primary):
  `received at 10:20`

Contacts context menu
- Pin/Unpin
- Add to group
- Send and request public key
- Clear history
- Delete contact

Contact list indicators
- Bright green: meshTalk online (keys valid, recent app activity).
- Dark green: meshTalk offline (seen by app before; fades during the first 24h).
- Yellow: Meshtastic-only online.
- Dark yellow: Meshtastic-only offline (fades during the first 24h).
- Hidden indicator: no Meshtastic device presence for >24h.
- On app close, client sends offline broadcast (`KOF1|...`), so peers can switch presence/routing immediately.

Settings
- Port is auto-detected (USB/serial scan). UI does not expose port selection.
- Retry interval, max wait, max bytes, rate, parallel packets (how many packets can be sent within one rate window).
- Auto pacing (optional): tunes `rate`/`parallel` automatically from ACK attempts/timeouts when backlog exists.
- Discovery: two checkboxes (`Send broadcast discovery`, `Reply to broadcast discovery`).
- Default on first start: both ON.
- Clear pending on profile switch.
- Language, verbose events, runtime.log toggle.
- Default on first start: `runtime.log` ON.
- Compression has its own Settings tab.
  - Recommended: AUTO (picks the smallest supported mode, only if it reduces payload size).
  - OFF disables payload compression (legacy chunking is still used).
  - Force algorithm can be used for experiments.
  - ZSTD (`mc_zstd`) is supported. Dependency: `zstandard` (see `requirements.txt`).
- Hint labels in settings use a smaller font (`QLabel#hint`, 10px) to avoid looking like regular options.
- `Full reset` button (red, with confirmation) removes profile config/state/history/incoming/runtime logs and key files, then regenerates local keys.

Auto key refresh
- Periodic key request roughly hourly (+ jitter).
- Auto key request on decrypt failures.
- Contact status indicator fades towards offline during the first 24 hours without activity.
- If meshTalk has not seen app activity from a contact for >24h, routing falls back to plain Meshtastic text
  until the contact returns to meshTalk.

Cryptography (where/when)
- This project uses cryptographic primitives for payload sealing and local at-rest sealing.
  It does not claim or guarantee any specific security properties.
- On startup the runtime log prints a `CRYPTO:` line with the active primitive set (MT-KEY, HKDF, MT-WIRE AEAD, at-rest sealing).
- MT-KEY v1 (KR1/KR2 key exchange frames):
  - Format: plaintext UTF-8/ASCII with `|` separators.
  - Public key: X25519 public key (32 raw bytes, base64 in the frame).
- MT-WIRE v1 (transport container):
  - AEAD: AES-256-GCM.
  - Key derivation: X25519 ECDH + HKDF-SHA256 -> 32-byte AES key (see `meshtalk/protocol.py` and `meshtalk/protocol.txt`).
  - Applied to all MSG/ACK frames sent over the Meshtastic `PRIVATE_APP` port.
- Local at-rest sealing (per node profile):
  - AEAD: AES-256-GCM.
  - Key file: `<node_id>/keyRings/storage.key` (32 bytes, base64; local-only).
  - Applied to sensitive fields in `history.log`, `state.json`, `incoming.json` (see `meshtalk/storage.py` and `meshtalk/storage.txt`).

Session rekey (where/when)
- Optional per-peer session key refresh runs inside the encrypted channel (`session_rekey`).
- Control frames are carried inside MT-MSG plaintext:
  - `RK1` (sender ephemeral public key)
  - `RK2` (response ephemeral public key)
  - `RK3` (final confirmation)
- Rekey updates a per-peer AES session key derived from HKDF(static_shared || ephemeral_shared).
- Rekey adds small extra control traffic and is intended for experiments.

Wire protocol and packet structure (reference)
- Full specification (versioned): `meshtalk/protocol.txt`.
- Key exchange (plaintext, MT-KEY v1):
  - `KR1|<sender_id>|<sender_pub_b64>|key=value|...`
  - `KR2|<sender_id>|<sender_pub_b64>|key=value|...`
- Cryptographic container (MT-WIRE v1, AES-256-GCM AEAD):
  - `[ver=1][type=1|2][msg_id(8)][nonce(12)][ct||tag]`
  - `type=1` MSG, `type=2` ACK
- Message framing (inside MT-WIRE type=MSG):
  - MT-MSG v2 (binary, prefix `M2`): header is 16 bytes, then chunk data.
  - MT-MSG v1 (legacy UTF-8, prefix `T...`) remains decodable for compatibility.
- ACK framing (inside MT-WIRE type=ACK): UTF-8 `ACK|mc=1|mc_modes=...|hops=<n>`.

Runtime log event types and UI colors
- This is only a UI aid for reading logs; colors do not imply severity guarantees.
- `ERROR` (red, `#f92672`): exceptions/tracebacks, pinned key mismatch, decode errors.
- `WARN` (orange, `#fd971f`): non-fatal warnings.
- `KEY` / `CRYPTO` (yellow, `#ffd75f`): key exchange, rekey, crypto diagnostics.
- `KEYOK` (yellow, `#ffd75f`): confirmed key exchange.
- `TRACE` (cyan, `#66d9ef`): traceroute operations and responses.
- `PACE` (green, `#a6e22e`): auto pacing suggestions and parameter changes.
- `HEALTH` (mint, `#6be5b5`): periodic health summary.
- `DISCOVERY` (violet, `#b894ff`): discovery scheduling/broadcast events.
- `RADIO` (blue, `#74b2ff`): radio connect/disconnect and low-level issues.
- `GUI` (light, `#e0e0e0`): GUI lifecycle events.
- `QUEUE` (sand, `#c3b38a`): queue state changes/clears.
- `COMPRESS` / `COMPSTAT` (default log color): compression decisions and periodic compression/normalization efficiency totals.

Data files (per node)
- `<node_id>/keyRings/`
- `<node_id>/keyRings/storage.key` (local at-rest storage key; cryptographic)
- `<node_id>/state.json`
- `<node_id>/history.log`
- `<node_id>/incoming.json`
- `<node_id>/runtime.log` (if enabled)
- `<node_id>/config.json`

meshTalk related files map (keep updated)
- This section is operationally important and must be updated periodically when behavior or file roles change.

Project files (repository / source-controlled)
- `meshTalk.py`:
  - Main app: radio lifecycle, MT-WIRE sealing, queue/retry/ACK, GUI, save/load state/history.
- `meshtalk/protocol.py`:
  - Wire protocol primitives: pack/unpack, X25519+HKDF key derivation, base64 helpers.
- `meshtalk/storage.py`:
  - Storage layer: config/state/history/incoming I/O, at-rest storage key, file hardening.
- `meshtalk/pacing.py`:
  - Adaptive sending pace controller: tunes `rate_seconds`/`parallel_sends` from recent ACK stats.
- `meshtalk_utils.py`:
  - Shared helpers: history encode/decode, parsers, metadata formatting, wire payload assembly.
- `message_text_compression.py`:
  - Compression codecs/modes used by message payload processing.
- `run_meshTalk.bat`: Windows launcher.
- `build_meshTalk.bat`: Windows single-file build helper.
- `requirements.txt`: Python dependencies.
- `requirements.txt`: Python dependencies (includes `zstandard` for ZSTD compression).
- `README.md`: project-level usage and options.
- `meshTalk.txt`: focused meshTalk behavior reference.
- `meshtools/meshLogger.txt`: focused meshLogger behavior reference.
- `meshtools/graphGen.txt`: focused graphGen behavior reference.
- `nodeDbUpdater.txt`: focused nodeDbUpdater behavior reference.
- `meshtalk_utils.txt`: focused meshtalk_utils module reference.
- `message_text_compression.txt`: focused text-compression module reference.
- `meshtalk/protocol.txt`: focused protocol module reference.
- `meshtalk/storage.txt`: focused storage module reference.
- `meshtalk/pacing.txt`: focused pacing module reference.
- `CHANGELOG.md`: changes between versions.

Generated during runtime (per profile/node, not source code)
- `config.json`: GUI/runtime options.
- `state.json`: outgoing pending queue records (used to restore unsent outgoing messages).
- `incoming.json`: incoming multipart assembly state.
- `history.log`: message history and transport events.
  - Text is stored as `enc1:...` (AES-256-GCM AEAD; key in `keyRings/storage.key`).
  - Legacy rows may contain `b64:...` (older versions).
  - Optional per-message metadata is stored as `meta64:...` (base64 JSON) for status restoration.
- `runtime.log`: technical runtime events.
- `keyRings/`: local private/public keys and peer public keys.
  - `storage.key`: 32-byte key used to seal persisted payload text at rest (`history.log`, sensitive fields in `state.json`/`incoming.json`).

History/recovery behavior
- On startup, app restores in this logical order:
  1) `history.log` (`recv/sent`) with metadata.
  2) outgoing pending state from `state.json`.
  3) incoming multipart state from `incoming.json`.
- Group rename moves history entries from old `group:<name>` id to new id.
- Group delete/clear removes corresponding entries from `history.log`.

========================
RU
========================

Назначение
- Исследовательский прототип P2P‑обмена полезной нагрузкой поверх Meshtastic (ACK/повторы + криптографические примитивы).
- Фокус: best-effort доставка и статистика доставки; изучение поведения mesh‑топологии.

Лицензия
- Apache License 2.0 (`LICENSE`).
- При распространении необходимо сохранять атрибуцию из `NOTICE`.

Видение проекта
- Для гражданского/любительского/исследовательского использования.
- Ориентировано на эксперименты по доставке/задержкам и изучение поведения mesh‑топологии.
- Военное применение прямо запрещено.
- Любая незаконная деятельность (включая террористическую, экстремистскую и преступную) прямо запрещена.
- Отказ от ответственности: ПО предоставляется «как есть», без каких-либо гарантий.
- Отказ от ответственности: автор не несет ответственности за любой прямой или косвенный ущерб от использования или неправильного использования.

Основной UI
- Слева: список контактов/диалогов.
- Справа: окно чата.
- Вверху: статусная строка `Client ID`, имена и маска `public key`.
  - Оранжевая: инициализация/переходные состояния (ожидание радио).
  - Темно‑зеленая: подключено, нет непросмотренных ошибок.
  - Красная: в логе были ошибки, требуется внимание (до открытия Настроек).
- Внизу: поле ввода и кнопка отправки.

Инициализация
- GUI запускается даже без подключенного радио.
- Подключение к радио — через serial-over-USB (COM на Windows, `/dev/ttyUSB*`/`/dev/ttyACM*` на Linux).
- Режим порта по умолчанию — `--port auto`: при старте приложение сканирует serial-порты и автоматически выбирает наиболее подходящий.
- Приложение ждет устройство, затем подключается автоматически и грузит профиль.
- Настройки/история загружаются только после инициализации ноды.
- Состояние приема многопакетных сообщений восстанавливается после перезапуска.

Поведение верхней строки
- `Client ID: !xxxxxxxx <longname>[<shortname>] public key: 12345****67890`
- ЛКМ по верхней строке копирует Client ID.
- Тройной клик по `public key:` просит подтверждение, регенерирует ключи, делает broadcast нового ключа.

Примеры статусов сообщений
- Исходящее в процессе:
  `отправлено в 10:18 прошло 00:05`
- Исходящее многопакетное в процессе:
  `отправлено в 10:18 прошло 00:12, части 2/5`
- Исходящее доставлено:
  `отправлена в 10:18 доставлено в 10:19 за 01:18, с 1 попытки, хопы туда 0 обратно 0`
- Исходящее доставлено со сжатием:
  `отправлена в 10:18 доставлено в 10:19 за 01:18, с 1 попытки, хопы туда 0 обратно 0, сжатие DEFLATE 42%`
- Входящее многопакетное в процессе:
  `в 10:18 начали прием, прошло 00:15 частей 2/5 с 1 попытки, хопов 1`
- Входящее получено полностью:
  `отправлено в 10:18 получено в 10:19 за 01:18, попытки 1, хопов 1, части 5/5`
- Обычный Meshtastic-канал, исходящее:
  `отправлено в 10:19`
- Обычный Meshtastic-канал, входящее:
  `пришло 10:20`

Контекстное меню контакта
- Pin/Unpin
- Add to group
- Traceroute request
- Отправить и запросить public key
- Clear history
- Delete contact

Индикаторы в списке контактов
- Ярко-зеленый: meshTalk online (ключи валидны, есть недавняя активность приложения).
- Темно-зеленый: meshTalk offline (приложение было видно раньше; затухает первые 24ч).
- Желтый: только Meshtastic online.
- Темно-желтый: только Meshtastic offline (затухает первые 24ч).
- Без индикатора: отсутствует присутствие устройства (Meshtastic) более 24ч.
- При закрытии приложения отправляется offline-broadcast (`KOF1|...`), чтобы пиры сразу гасили app-online состояние и переключали роутинг.

Настройки
- Порт выбирается автоматически (скан USB/serial). В UI выбора порта нет.
- Повтор, макс ожидание, макс байт, минимальный интервал, параллельно (сколько пакетов можно отправить подряд в одном окне rate).
- Автоподбор скорости (опционально): автоматически подбирает `интервал/параллельно` по попыткам ACK/таймаутам при наличии очереди.
- Discovery: две галки (`Отправлять broadcast discovery`, `Отвечать на broadcast discovery`).
- По умолчанию при первом запуске: обе ВКЛ.
- Очистка очереди при смене профиля.
- Язык, подробный лог, включение `runtime.log`.
- По умолчанию при первом запуске: `runtime.log` ВКЛ.
- Сжатие вынесено на отдельную вкладку в настройках.
  - Рекомендуется: AUTO (выбирает самый выгодный поддерживаемый режим и включает сжатие только при выигрыше по размеру).
  - OFF отключает сжатие (legacy разбиение на части при этом остается).
  - Принудительный алгоритм нужен для экспериментов.
  - ZSTD (`mc_zstd`) поддерживается. Зависимость: `zstandard` (см. `requirements.txt`).
  - Нормализация (перед сжатием) обратима и влияет только на эффективность: получатель восстановит точный исходный текст.
    - OFF: без нормализации.
    - Token stream (базовый, обратимый): сериализация точных токенов (включая пробелы) перед бинарным сжатием.
    - SentencePiece vocab (обратимый): жадная токенизация по `meshtalk/sp_vocab.txt` перед бинарным сжатием.
      `sentencepiece` используется только чтобы генерировать/обновлять vocab; на декодирование он не влияет.
- Подсказки в настройках показываются меньшим шрифтом (`QLabel#hint`, 10px), чтобы не выглядеть как обычные опции.
- Кнопка `Полный сброс` (красная, с подтверждением) удаляет конфиг/очереди/историю/incoming/runtime.log и ключи профиля, затем создает новую пару локальных ключей.

Автообновление ключей
- Периодический запрос ключа примерно раз в час (+ джиттер).
- Автозапрос ключа при ошибках обработки криптографического контейнера.
- Замок убирается, если ключ не обновлялся более 24 часов.

Криптография (где/когда)
- В проекте используются криптографические примитивы для запечатывания payload и локального запечатывания данных на диске.
- При старте в runtime‑логе печатается строка `CRYPTO:` с набором активных примитивов (MT‑KEY, HKDF, MT‑WIRE AEAD, запечатывание на диске).
- MT-KEY v1 (обмен ключами, кадры KR1/KR2):
  - Формат: plaintext UTF-8/ASCII с разделителем `|`.
  - Публичный ключ: X25519 public key (32 raw bytes, base64 внутри кадра).
- MT-WIRE v1 (транспортный контейнер):
  - AEAD: AES-256-GCM.
  - Вычисление ключа: X25519 ECDH + HKDF-SHA256 -> 32‑байтный AES key (см. `meshtalk/protocol.py` и `meshtalk/protocol.txt`).
  - Применяется ко всем MSG/ACK кадрам, отправляемым через Meshtastic `PRIVATE_APP`.
- Локальное запечатывание на диске (профиль ноды):
  - AEAD: AES-256-GCM.
  - Файл ключа: `<node_id>/keyRings/storage.key` (32 байта, base64; строго локальный).
  - Применяется к чувствительным полям `history.log`, `state.json`, `incoming.json` (см. `meshtalk/storage.py` и `meshtalk/storage.txt`).

Rekey сессии (где/когда)
- Опциональное обновление session key на каждого пира выполняется внутри зашифрованного канала (`session_rekey`).
- Управляющие кадры передаются внутри MT-MSG plaintext:
  - `RK1` (ephemeral public key отправителя)
  - `RK2` (ответ ephemeral public key)
  - `RK3` (финальное подтверждение)
- Rekey обновляет per-peer AES session key, вычисленный как HKDF(static_shared || ephemeral_shared).
- Rekey добавляет небольшой служебный трафик и предназначен для экспериментов.

Wire протокол и структура пакетов (справка)
- Полная спецификация (с версионированием): `meshtalk/protocol.txt`.
- Обмен ключами (plaintext, MT-KEY v1):
  - `KR1|<sender_id>|<sender_pub_b64>|key=value|...`
  - `KR2|<sender_id>|<sender_pub_b64>|key=value|...`
- Криптоконтейнер (MT-WIRE v1, AES-256-GCM AEAD):
  - `[ver=1][type=1|2][msg_id(8)][nonce(12)][ct||tag]`
  - `type=1` MSG, `type=2` ACK
- Фрейминг сообщений (внутри MT-WIRE type=MSG):
  - MT-MSG v2 (бинарный, префикс `M2`): заголовок 16 байт + chunk данные.
  - MT-MSG v1 (legacy UTF-8, префикс `T...`) остается декодируемым для совместимости.
- ACK (внутри MT-WIRE type=ACK): UTF-8 `ACK|mc=1|mc_modes=...|hops=<n>`.

Типы событий runtime-лога и цвета в UI
- Это только помощь для чтения логов; цвета не являются обещанием "важности".
- `ERROR` (красный, `#f92672`): исключения/traceback, pinned key mismatch, decode errors.
- `WARN` (оранжевый, `#fd971f`): предупреждения без падения.
- `KEY` / `CRYPTO` (желтый, `#ffd75f`): обмен ключами, rekey, крипто‑диагностика.
- `KEYOK` (желтый, `#ffd75f`): подтвержденный обмен ключами.
- `TRACE` (голубой, `#66d9ef`): traceroute и его ответы.
- `PACE` (зеленый, `#a6e22e`): автоподбор скорости и изменения параметров.
- `HEALTH` (мятный, `#6be5b5`): периодическая health‑строка.
- `DISCOVERY` (фиолетовый, `#b894ff`): discovery/broadcast события и планирование.
- `RADIO` (синий, `#74b2ff`): подключение/отключение радио и низкоуровневые события.
- `GUI` (светлый, `#e0e0e0`): события GUI.
- `QUEUE` (песочный, `#c3b38a`): изменения очереди/очистка.
- `COMPRESS` / `COMPSTAT` (цвет по умолчанию): решения по сжатию и периодическая сводка эффективности сжатия/нормализации.

Файлы данных (на каждую ноду)
- `<node_id>/keyRings/`
- `<node_id>/keyRings/storage.key` (локальный ключ хранения на диске; криптографический)
- `<node_id>/state.json`
- `<node_id>/history.log`
- `<node_id>/incoming.json`
- `<node_id>/runtime.log` (если включен)
- `<node_id>/config.json`

Карта связанных файлов meshTalk (поддерживать актуальной)
- Этот раздел операционно важен и должен периодически обновляться при изменении поведения или ролей файлов.

Файлы проекта (в репозитории / исходники)
- `meshTalk.py`:
  - Основное приложение: жизненный цикл радио, MT-WIRE запечатывание, очередь/повторы/ACK, GUI, сохранение/загрузка состояния и истории.
- `meshtalk/protocol.py`:
  - Примитивы wire-протокола: pack/unpack, вычисление ключа X25519+HKDF, base64‑помощники.
- `meshtalk/storage.py`:
  - Слой хранения: I/O config/state/history/incoming, ключ хранения на диске, hardening прав файлов.
- `meshtalk/pacing.py`:
  - Автоподбор скорости отправки: подбирает `rate_seconds`/`parallel_sends` по статистике ACK.
- `meshtalk_utils.py`:
  - Общие утилиты: кодирование/декодирование истории, парсеры, форматирование метаданных, сборка wire-пакетов.
- `message_text_compression.py`:
  - Алгоритмы/режимы сжатия для полезной нагрузки сообщений.
- `run_meshTalk.bat`: запуск на Windows.
- `build_meshTalk.bat`: сборка single-file для Windows.
- `requirements.txt`: Python-зависимости.
- `requirements.txt`: зависимости Python (включая `zstandard` для сжатия ZSTD).
- `README.md`: общее использование проекта и параметры.
- `meshTalk.txt`: целевая справка по поведению meshTalk.
- `meshtools/meshLogger.txt`: целевая справка по поведению meshLogger.
- `meshtools/graphGen.txt`: целевая справка по поведению graphGen.
- `nodeDbUpdater.txt`: целевая справка по поведению nodeDbUpdater.
- `meshtalk_utils.txt`: целевая справка по модулю meshtalk_utils.
- `message_text_compression.txt`: целевая справка по модулю сжатия текста.
- `meshtalk/protocol.txt`: целевая справка по модулю протокола.
- `meshtalk/storage.txt`: целевая справка по модулю хранения.
- `meshtalk/pacing.txt`: целевая справка по модулю автоскорости.
- `CHANGELOG.md`: изменения между версиями.

Генерируется во время работы (на профиль/ноду, не исходники)
- `config.json`: настройки GUI/runtime.
- `state.json`: очередь исходящих pending-записей (для восстановления недоотправленных исходящих).
- `incoming.json`: состояние сборки входящих многопакетных сообщений.
- `history.log`: история сообщений и транспортные события.
  - Текст хранится как `enc1:...` (AES-256-GCM AEAD; ключ в `keyRings/storage.key`).
  - В старых строках может встречаться `b64:...` (старые версии).
  - Опциональные метаданные сообщения хранятся как `meta64:...` (base64 JSON) для восстановления статусов.
- `runtime.log`: технические runtime-события.
- `keyRings/`: локальные приватный/публичный ключи и публичные ключи пиров.
  - `storage.key`: 32-байтный ключ, которым запечатывается текст полезной нагрузки при сохранении на диск (`history.log` и чувствительные поля `state.json`/`incoming.json`).

Поведение восстановления
- При старте приложение восстанавливает данные логически в таком порядке:
  1) `history.log` (`recv/sent`) вместе с метаданными.
  2) pending-исходящие из `state.json`.
  3) входящие multipart из `incoming.json`.
- При переименовании группы записи истории переносятся со старого `group:<name>` на новый id.
- При удалении/очистке группы соответствующие строки удаляются из `history.log`.
